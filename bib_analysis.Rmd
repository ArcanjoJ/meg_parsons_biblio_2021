---
title: "bib_analysis"
output: html_document
---

# Workflow

- Clean DB

- Number of articles through time

- Which journals are being published in bar graph

- mean number of authors per articles

- Author collaboration network (tidygraph/tidygraph)

- Institution not always linked to country. George has code

- George has code to clean language special characters

- Finn did author initials cleaning code

- Keyword co-occurance (can split out by time)

- ngrams (whole abstract; tidytex)

- LDA topic within topic

- DO THIS BETORE TOPIC MODELLING Stopwords (throw out the, a, and ...) and lemitize (contractions), another that does run/ran (tidytex)

- revtools package



Check

- column outliers

- abstracts/keywords

- unrelated titles

- DOI (ISSN may be a bad record)

- Language (english)


```{r include=FALSE}
library(tidyverse)
# library(data.table)
library(janitor)
library(rscopus)
library(lubridate)

```

# Meta analysis

The following code requires on-campus network access. Workaround for lockdown was to use a nectar VM. Using the UoA squid proxy should work as well. The data from the query have been downloaded and saved so the following code is commented out. 1827 results have been returned


```{r include=FALSE}
# rscopus::set_api_key("cf71c76658efeaf1c2da32d64bc8e1d6")
# scopus_query <- scopus_search(query = "TITLE-ABS-KEY ( \"climate justice\"  OR  
#                        \"environmental justice\"  OR  \"social justice\"  AND  
#                        \"climate change\"  OR  \"Global warming\" )  AND  
#                        ( LIMIT-TO ( DOCTYPE ,  \"ar\" )  OR  
#                        LIMIT-TO ( DOCTYPE ,  \"ch\" )  OR  
#                        LIMIT-TO ( DOCTYPE ,  \"re\" )  OR  
#                        LIMIT-TO ( DOCTYPE ,  \"bk\" ) )  AND  
#                        ( LIMIT-TO ( LANGUAGE ,  \"English\" ) )", 
#                        view = "COMPLETE", count = 25, max_count = 2500)
# 
# scopus_results <- gen_entries_to_df(res70$entries)
```


```{r include=FALSE}
scopus_results <- readRDS("data/scopus_api_1827.rds")
scopus_results <- lapply(scopus_results, clean_names)
str(scopus_results[[1]])

author_df <- scopus_results[[1]] |> 
  mutate(prism_cover_display_date = as_date(prism_cover_display_date),
         author_count_total = as.numeric(author_count_total),
         year = floor_date(prism_cover_date, "year"),
         prism_issn = as.numeric(prism_e_issn),
         prism_e_issn = as.numeric(prism_e_issn),
         prism_volume = as.numeric(prism_volume)
         )
```


```{r include=FALSE}
publications_by_year <- author_df |> 
  select(year) |>
  group_by(year) |> 
  summarise(count = length(year))

ggplot(publications_by_year, aes(x = year, y = count)) +
  geom_line()

```



```{r include=FALSE}
mean_author_by_year <- author_df |> 
  select(year, author_count_total) |>
  group_by(year) |> 
  summarise(mean_auth = mean(author_count_total))

ggplot(mean_author_by_year, aes(x = year, y = mean_auth)) +
  geom_line()

```







# Within topic 

https://www-scopus-com.ezproxy.auckland.ac.nz/results/results.uri?sort=plf-f&src=s&nlo=&nlr=&nls=&sid=b91254e0173e72feda07c43a9dd9d979&sot=a&sdt=cl&cluster=scosubtype%2c%22ar%22%2ct%2c%22ch%22%2ct%2c%22re%22%2ct%2c%22bk%22%2ct%2bscolang%2c%22English%22%2ct&sl=120&s=TITLE-ABS-KEY%28%22climate+justice%22+OR+%22environmental+justice%22+OR+%22social+justice%22+AND+%22climate+change%22+OR+%22Global+warming%22%29&origin=resultslist&zone=leftSideBar&editSaveSearch=&txGid=a5a71838be4b9defe5665bc7715daff0